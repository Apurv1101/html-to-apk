name: Cordova WebView APK Build (Clean & Working)

on:
  push:
    branches: [ main ]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: ğŸ“¥ Checkout Code
      uses: actions/checkout@v3

    - name: ğŸŸ¢ Setup Node.js
      uses: actions/setup-node@v3
      with:
        node-version: 18

    - name: ğŸ“¦ Install Cordova
      run: npm install -g cordova

    - name: ğŸ“ Create Cordova Project and Add Plugins
      run: |
        cordova create cordovaapp com.example.localwebapp LocalWebApp
        cd cordovaapp
        cordova platform add android@12
        cordova plugin add cordova-plugin-camera
        cordova plugin add cordova-plugin-media-capture
        cordova plugin add cordova-plugin-media
        cordova plugin add cordova-plugin-android-permissions
        cordova plugin add cordova-plugin-whitelist

    - name: ğŸ“ Copy HTML and Assets to www/
      run: |
        cp app.html cordovaapp/www/index.html
        cp logo.jpg cordovaapp/www/logo.jpg || true
        cp thankyou.mp3 cordovaapp/www/thankyou.mp3 || true
        cp config.xml cordovaapp/config.xml || true

    - name: ğŸ› ï¸ Build Cordova APK
      run: |
        cd cordovaapp
        cordova build android --verbose || true

    - name: ğŸ” Find APK Anywhere
      run: |
        find cordovaapp/platforms/android/ -type f -name "*.apk" || echo "âŒ No APK found"

    - name: ğŸ“¤ Upload APK (if exists)
      uses: actions/upload-artifact@v4
      with:
        name: webview-apk
        path: cordovaapp/platforms/android/app/build/outputs/apk/**/*.apk
